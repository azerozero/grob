# Nextest configuration — https://nexte.st/book/configuration
# Run with: cargo nextest run

[store]
dir = "target/nextest"

# Default profile: local dev and CI
[profile.default]
# Retry flaky tests once before failing
retries = 1
# Per-test timeout (catch infinite loops / deadlocks)
slow-timeout = { period = "30s", terminate-after = 2 }
# Fail fast: stop on first failure in CI (overridden in dev profile)
fail-fast = true
# Status output level
status-level = "pass"
final-status-level = "flaky"

# Local development: more lenient
[profile.dev]
retries = 0
fail-fast = false
slow-timeout = { period = "60s", terminate-after = 2 }

# CI profile: strict, with JUnit output for test reporting
[profile.ci]
retries = 2
fail-fast = true
slow-timeout = { period = "30s", terminate-after = 2 }
status-level = "retry"
final-status-level = "slow"

# Test groups — isolate heavy tests that can't run in parallel
[test-groups.serial-integration]
max-threads = 1

# Assign integration tests to serial group (they bind ports / use shared state)
[[profile.default.overrides]]
filter = "test(/^integration/)"
test-group = "serial-integration"
